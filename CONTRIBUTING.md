# Contributing

## Table of contents

1. [Introduction](#introduction)
2. [Project Stack](#project-stack)
3. [Project Structure](#project-structure)
4. [How to contribute](#how-to-contribute)
5. [Useful commands](#useful-commands)
6. [How to add a new dependency](#how-to-add-a-new-dependency)

   -  [For frontend app (react)](#for-frontend-app-react)
   -  [For server app (django)](#for-server-app-django)

7. [Pull Request Process](#pull-request-process)

## Introduction

Welcome to the learn-hub contributor guide! This document outlines the learn-hub
repository's process for community interaction and contribution. This is an
entry point for anyone wishing to contribute their time and effort to make
learn-hub project better and help the community.

All the interactions in the learn-hub repository are covered in the [code of conduct](CODE_OF_CONDUCT.md).

## Project Stack

The project follows a [RESTful architecture](https://medium.com/@ahmetozlu93/mastering-rest-architecture-rest-architecture-details-e47ec659f6bc).

-  The front application uses [ReactJS](https://reactjs.org/docs/getting-started.html) **v16+**, with **TypeScript** instead of JavaScript.
-  The server application (API) uses [django](https://docs.djangoproject.com/en/3.0/) **v3+** (with **Python 3.8**).
-  The [django-rest-framework](https://www.django-rest-framework.org/) **v3+** framework is used for the REST layer.
-  Applications (client and server) images are built with [docker](https://docs.docker.com/get-started/).
-  The local (dev) environment is built and run using [docker compose](https://docs.docker.com/compose/) **v3.4+**.
-  [pytest](https://docs.pytest.org/en/latest/getting-started.html) is used for unit-tests (in the server application).
-  [Travis-CI](https://travis-ci.org/) is used for CI/CD.
-  [Codecov](http://codecov.io/) is used for code coverage (in the server application).

## Project Structure

```
/
├──📂 ui/
│   │                             # Directory that contains the frontend application.
│   │                             # (react application root directory). Note that
│   │                             # the applications uses typescript instead of JS.
│   │
│   ├──📂 src/                    # Main directory for the react app. Contains all
│   │                             # the application components (the root component
│   │                             # is rendered in `index.tsx`). Read React
│   │                             # documentation for more details.
│   │
│   ├──📂 public/                 # Contains all the front app page template
│   │                             # (index.html) and static assets. Read React
│   │                             # documentation for more details.
│   │
│   ├──📦 node_modules/           # Vendored dependencies for the frontend app
│   │                             # Managed automatically by the package manager.
│   │
│   ├──📓 package.json            # The frontend app main manifest file.
│   │
│   ├──📃 README.md               # Generated by `create-react-app`, describing all
│   │                             # the available commands.
│   │
│   ├──🔠 tsconfig.json           # Describes how the TS will be transpiled into JS
│   │
│   └──🎞️  Dockerfile             # Describes how to build frontend app docker image.
│                                 # For the moment, only the local image is built.
│
├──📂 core/
│   │                             # Directory that contains all the application backend
│   │                             # (django project root directory, flattened to
│   │                             # avoid having useless nested directories).
│   │
│   ├──📂 accounts/               # Django application to manage all account-related
│   │                             # resources: users, authentication tokens, etc.
│   │
│   ├──⚙️  .coveragerc             # Code coverage settings.
│   │
│   ├──⚙️  pytest.ini              # Test running (pytest) settings.
│   │
│   ├──🔋 requirements.in         # "human written" project requirements. Check
│   │                             # the "how to add a new dependency" section.
│   │
│   ├──🧪  dev-requirements.in    # Same as `requirements.in`, but for development tools
│   │                             # (linting, testing, debugging, etc.)
│   │
│   ├──🔋 requirements.txt        # Project requirements file (generated automatically
│   │                             # with the `pip-compile` command from `requirements.in`)
│   │
│   ├──🧪  dev-requirements.txt   # Same as `requirements.txt`, but for development tools.
│   │
│   ├──🔧 docker-entrypoint.sh    # Shell script executed on each `docker-compose up`
│   │                             # command to make sure that django migrations are
│   │                             # installed.
│   │
│   └──🎞️  Dockerfile             # Blueprint describing how to build backend app docker
│                                 # images for all kind of environments: local (dev),
│                                 # CI (test) and production.
│
├──📂 .github/
│   │                             # Directory that contains all github-only
│   │                             # related resources.
│   │
│   ├──🦴  ISSUE_TEMPLATE.md
│   │
│   └──🦴  PULL_REQUEST_TEMPLATE.md
│
├──🛠️  docker-compose.yml          # Builds and starts the whole project for LOCAL use.
│                                 # It links project services (react app, django app
│                                 # and the posgres database)
│
├──🛠️  .travis.yml                 # Describes the whole CI/CD pipeline (Building docker
│                                 # images, running linters, running tests, then
│                                 # measuring code coverage)
│
├──📍 CONTRIBUTING.md             # This file!
│
├──🤓 CODE_OF_CONDUCT.md          # The name sums it all up!
│
├──🏃 LICENSE                     # The project license file (GPLv3), so boring!
│
└──📃 README.md                   # Describes the purpose of the repository, how to
                                  # use it, etc.)
```

## How to contribute

When contributing to this repository, please first discuss the change you wish to make via issue,
email, or any other method with the owners of this repository before making a change.

Note that we have a code of conduct, please follow it in all your interactions with the project.

## Useful commands

Note: All the `docker-compose` commands could be run from project root or any sub-directory.

-  Running the project locally (and building it if it's not already built):

```shell
docker-compose up
```

-  Running the project locally, in the background

```shell
docker-compose up -d
```

-  Stopping the project run (the project should be running)

```shell
docker-compose down
```

-  Displaying project logs (all services) (the project should be running)

```shell
docker-compose logs
```

-  Displaying logs for a given service (`postgres_db`|`web-server`|`ui`). The
   project should be running.

```shell
docker-compose logs [service_name]
```

-  Building (or re-building) project images (after adding a new dependency)

```shell
docker-compose build
```

-  Executing a custom command inside a running service (`postgres_db`|`web-server`|`ui`) (the project should be running)

```shell
docker-compose exec [service_name] [command] [command_args]
```

Example: If you want to run migrations for the django app: `docker-compose exec web-server python manage.py migrate`

-  Accessing to a given service's shell (`postgres_db`|`web-server`|`ui`) (the project should be running)

```shell
docker-compose exec [service_name] sh
```

Note: if you want to close the shell, use the `exit` command, or `CTRL+D`

## How to add a new dependency

Note: For adding dependencies, your application should be running.

### For frontend app (react)

In order to include a new dependency to the project:

1. Access to your container's shell using the `docker-compose exec ui sh` command.
1. Install your new package with `npm install [options] [your_package_name]`.
1. Stop your app and rebuild the docker images (`docker-compose stop && docker-compose build`).
1. Re-run your app (`docker-compose up`).

Your `package.json` and `package-lock.json` files should have been updated
during the process.

### For server app (django)

In order to include a new python dependency to the project:

1. Add your dependency in the `requirements.in` file.
1. Access to your container's shell using the `docker-compose exec web-server sh` command
1. Generate the `requirements.txt` file with: `pip-compile --output-file=requirements.txt requirements.in`
1. Stop your app and rebuild the docker images (`docker-compose stop && docker-compose build`)
1. Re-run your app (`docker-compose up`)

Your `requirements.in` and `requirements.txt` files should have been updated during the process.

**Important Note:** If the new dependency is meant to be used during the development/test only (i.e. won't be used in production),
follow the same steps above, just use `dev-requirements.in`/`dev-requirements.txt` instead of `requirements.in`/`requirements.txt`

**Important Note 2:** Do not update `requirements.txt` and `dev-requirements.txt` manually. They should be generated automatically with the `pip-compile` command.

## Pull Request Process

1. Ensure any install or build dependencies are removed before the end of the layer when doing a
   build.
2. While working on your branch, don't merge master into your branch. Instead, rebase on master, to preserve a clean project history.
3. Update the README.md with details of changes to the interface, this includes new environment
   variables, exposed ports, useful file locations and container parameters.
4. Increase the version numbers in any examples files and the README.md to the new version that this
   Pull Request would represent. The versioning scheme we use is [SemVer](http://semver.org/).
5. Squash your commits. Your (only) commit should be clear and self explanatory
   (check [those guidelines](https://gist.github.com/robertpainsi/b632364184e70900af4ab688decf6f53))
6. Once the Pull Request created, you may assign the project maintainer for the review process. Once the PR approved, he'll merge it for you (in case you do not have permission to do that)
